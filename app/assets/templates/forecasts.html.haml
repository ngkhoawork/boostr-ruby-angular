#forecasts.z-styles.z-report
	.container-fluid.inner-forecasts
		.row.mb20
			.reports-header
				.header-cell.main-title
					Forecast
				.header-cell.filters-block
					%table
						%tr.filter-title
							%td Team
							%td Seller
							%td Product
							%td Time period
							%td
								%span.reset-filter{'ng-click': 'resetFilter()'}
									Reset
						%tr
							%td
								%tree-dropdown{ class:"tree-dropdown team-list", data:"teams", selected: 'filter.team', 'ng-class': '{"empty": filter.team.name === "All"}'}

							%td
								%ul.filter-item
									%li{ dropdown: true }
										%a{ href: '', dropdown: { toggle: true }, 'ng-class': '{"empty": !filter.seller.id}' }
											{{filter.seller.name}}
											%span.caret
										%ul.dropdown-menu
											%li{'ng-class': '{active: !filter.seller.id}'}
												%a{href: '', 'ng-click': 'setFilter("seller", emptyFilter)'}
													{{emptyFilter.name}}
											%li{ ng: { repeat: 'seller in sellers | orderBy : "name"', class: '{active: seller.id === filter.seller.id}' } }
												%a{ href: '', ng: { click: 'setFilter("seller", seller)' } }
													{{seller.name}}

							%td
								%ul.filter-item
									%li{ dropdown: true }
										%a{ href: '', dropdown: { toggle: true }, 'ng-class': '{"empty": !filter.product.id}' }
											{{filter.product.name}}
											%span.caret
										%ul.dropdown-menu
											%li{'ng-class': '{active: !filter.product.id}'}
												%a{href: '', 'ng-click': 'setFilter("product", emptyFilter)'}
													{{emptyFilter.name}}
											%li{ ng: { repeat: 'product in products | orderBy : "name"', class: '{active: product.id === filter.product.id}' } }
												%a{ href: '', ng: { click: 'setFilter("product", product)' } }
													{{product.name}}
							%td
								%ul.filter-item
									%li{ dropdown: true }
										%a{href: '', dropdown: { toggle: true }, 'ng-class': '{"empty": !filter.timePeriod.id}' }
											{{filter.timePeriod.name || 'All'}}
											%span.caret
										%ul.dropdown-menu
											%li{ ng: { repeat: 'timePeriod in timePeriods | orderBy : ["period_type", "start_date"]', class: '{active: timePeriod.id === filter.timePeriod.id}' } }
												%a{ href: '', ng: { click: 'setFilter("timePeriod", timePeriod)' } }
													{{timePeriod.id !== 'all' ? timePeriod.name : 'All'}}
				.header-cell
					%b Show UW
					.show-hide-remainder-form.m0
						.switch-remainder-form
							%input#unweighted-toggle.cmn-toggle.cmn-toggle-round-flat{type: 'checkbox', 'ng-checked': 'isUnweighted', 'ng-click': 'toggleUnweighted($event)'}
							%label{for: 'unweighted-toggle'}
								%span

		.row.mb20
			.col-xs-9.pl0
				.block
					.table-wrapper
						%div#forecast-chart-container.mb20
							%svg#forecast-chart.forecast-chart
							%div.legend-container
					.table-wrapper
						%table.table.table-hover
							%thead
								%tr
									%th Name
									%th Quota
									%th Revenue
									%th Pipeline (W)
									%th Forecast Amt
									%th Gap to Quota
									%th % to Quota
									%th % Booked
									%th # Deals Needed
									%th WoW Pipeline
									%th Wow Revenue
							%tbody{'ng-repeat': 'team in forecast.teams'}
								%tr
									%td {{team.name + (team.quarter ? ' Q' + team.quarter : '')}}
									%td {{team.quota | currency : '$' : 0}}
									%td
										%a{href: '', 'ng-click': 'showSubtable("revenue", team.id, $event)'} {{team.revenue | currency : '$' : 0}}
									%td.subtable-arrow-wrap
										%div
											%a{href: '', 'ng-click': 'showSubtable("pipeline", team.id, $event)'} {{team.weighted_pipeline | currency : '$' : 0}}
											%i.fa.fa-caret-up.subtable-arrow
									%td {{team.amount | currency : '$' : 0}}
									%td {{team.gap_to_quota | currency : '$' : 0}}
									%td {{roundNumber(team.percent_to_quota)}}%
									%td {{roundNumber(team.percent_booked)}}%
									%td {{team.new_deals_needed}}
									%td {{team.wow_weighted_pipeline | currency : '$' : 0}}
									%td {{team.wow_revenue | currency : '$' : 0}}
								%tr.subtable-row
									%td.auto-colspan
										%div.subtable-wrap.pipeline-subtable
											%div.subtable-container
												%div.mb10
													%span.title Deal Summary
													%span.close-btn{'ng-click': 'hideSubtable()'}
												%table.subtable
													%thead
														%tr
															%th Deal Name
															%th Advertiser
															%th Agency
															%th Seller
															%th %
															%th Budget (UW)
															%th In Period Amt
															%th Start Date
															%th End Date
															%th Stage (D)
															%th Opened (D)
													%tbody
														%tr
															%td
															%td
															%td
															%td
															%td
															%td
															%td
															%td
															%td
															%td
															%td

			.col-xs-3.pr0
				.block
					%div.mb20
						%span.title Forecast Insights
					%h5 Pipeline Concentration Risk
					%table.table.table-stripped.mb10
						%thead
							%tr
								%th % of Deals
								%th % Total Pipe Value
								%th # Deals
						%tbody
							%tr
								%td 20%
								%td -50%-------------
								%td 5
							%tr
								%td 30%
								%td -75%-------------
								%td 10
							%tr
								%td 50%
								%td -100%------------
								%td 20

					%h5 Deals Missing IOs
					%table.table.table-stripped.mb10
						%thead
							%tr
								%th # Deals
								%th Value
						%tbody
							%tr
								%td 3
								%td {{200000 | currency : '$' : 0}}
							%tr
								%td 5
								%td {{450000 | currency : '$' : 0}}

					%h5 Underdelivery (UD) Risk
					%table.table.table-stripped.mb10
						%thead
							%tr
								%th # Lines
								%th UD Risk Amount
						%tbody
							%tr
								%td 5
								%td {{100000 | currency : '$' : 0}}
							%tr
								%td 10
								%td {{300000 | currency : '$' : 0}}