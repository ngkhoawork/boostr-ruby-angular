#pipeline-split-report.z-styles
	.container-fluid
		.row.mb20
			.reports-header
				.header-cell.main-title
					Pipeline Split Adjusted
				.header-cell.filters-block
					%table
						%tr.filter-title
							%td Team
							%td Seller
							%td Stage
							%td Status
							%td
								%span.reset-filter{'ng-click': 'resetFilter()'}
									Reset
						%tr
							%td
								%tree-dropdown{ class:"tree-dropdown team-list", data:"teams", selected: 'filter.team', 'ng-class': '{"empty": filter.team.name === "All"}'}

							%td
								%ul.filter-item
									%li{ dropdown: true }
										%a{ href: '', dropdown: { toggle: true }, 'ng-class': '{"empty": filter.seller.name === "All"}' }
											{{(filter.seller.first_name && filter.seller.first_name + ' ' + filter.seller.last_name) || 'All'}}
											%span.caret
										%ul.dropdown-menu
											%li{ ng: { repeat: 'seller in sellers', class: '{active: seller.id === filter.seller.id}' } }
												%a{ href: '', ng: { click: 'setFilter("seller", seller)' } }
													{{ seller.first_name + ' ' + seller.last_name}}

							%td
								%ul.filter-item
									%li{ dropdown: true }
										%a{ href: '', dropdown: { toggle: true }, 'ng-class': '{"empty": filter.stages.length == 0}' }
											%span{'ng-if': 'filter.stages.length == 0'}
												All
											%span{'ng-repeat': 'stage in filter.stages'}
												{{stage.name}} {{stage.probability + '%'}}
												%i.fa.fa-times.close-btn{'ng-click': 'removeFilter("stages", stage)'}
											%span.caret
										%ul.dropdown-menu
											%li{ ng: { repeat: 'stage in stages | orderBy: ["-open", "probability"]' } }
												%a{ href: '', ng: { click: 'setFilter("stages", stage)' } }
													{{stage.name}} {{isNumber(stage.probability) ? stage.probability + '%' : ''}}

							%td
								%ul.filter-item
									%li{ dropdown: true }
										%a{ href: '', dropdown: { toggle: true }, 'ng-class': '{"empty": filter.status.name === "All"}' }
											{{filter.status.name}}
											%span.caret
										%ul.dropdown-menu
											%li{ ng: { repeat: 'status in statuses', class: '{active: status.name === filter.status.name}' } }
												%a{ href: '', ng: { click: 'setFilter("status", status)' } }
													{{ status.name }}

				.header-cell
					%button.add-btn{'ng-click': 'applyFilter()'}
						Run Report

				.header-cell
					.pull-right
						%download-button{'ng-click': 'export()'}
							Export

		.row
			.col-xs-12
				.block
					%div.table-wrapper
						%table.table.table-hover
							%thead
								%tr
									%th Deal ID
									%th Name
									%th Advertiser
									%th Agency
									%th Team Member
									%th Split %
									%th Budget
									%th Stage
									%th Probability
									%th Type
									%th Source
									%th Next Steps
									%th Start Date
									%th End Date
									%th Created Date
									%th Closed Date
							%tbody
								%tr{'ng-repeat': 'item in data'}
									%td {{item.deal_id}}
									%td
										%a{href: '', 'ng-href': '/deals/{{item.deal_id}}'} {{item.deal_name}}
									%td
										%a{href: '', 'ng-href': '/accounts/{{item.advertiser.id}}'} {{item.advertiser.name}}
									%td
										%a{href: '', 'ng-href': '/accounts/{{item.agency.id}}'} {{item.agency.name}}
									%td {{item.name}}
									%td {{item.share}}%
									%td {{item.budget | currency : '$' : 0}}
									%td {{item.stage.name}}
									%td {{item.stage.probability}}
									%td {{item.type}}
									%td {{item.source}}
									%td {{item.next_steps}}
									%td {{item.start_date}}
									%td {{item.end_date}}
									%td {{item.created_date}}
									%td {{item.closed_date}}
